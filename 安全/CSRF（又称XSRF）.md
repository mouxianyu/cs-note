**跨站请求伪造**（英语：Cross-site request forgery），也被称为**one-click attack**或者**session riding**，通常缩写为**CSRF**或者**XSRF**，是一种挟制用户在当前已登录的Web应用程序上执行非本意的操作的攻击方法。跟[跨网站脚本](https://zh.wikipedia.org/wiki/%E8%B7%A8%E7%B6%B2%E7%AB%99%E6%8C%87%E4%BB%A4%E7%A2%BC "跨网站脚本")（XSS）相比，XSS利用的是用户对指定网站的信任，CSRF利用的是网站对用户网页浏览器的信任。

## 定义
CSRF攻击是一种利用用户当前已通过身份验证的会话来执行未经授权的操作的攻击方式。攻击者通过伪造请求，诱使用户在已登录的状态下误触发某些操作，例如转账、更改密码等，从而达到攻击目的。
**自己描述**：攻击者构造恶意请求，如一个链接可以进行诸如转账的操作，因为登录信息放在cookie中，cookie会跟着请求发送到服务器上。

## 攻击细节
跨站请求攻击，简单地说，是攻击者通过一些技术手段欺骗用户的浏览器去访问一个自己曾经认证过的网站并执行一些操作（如发邮件，发消息，甚至财产操作如转账和购买商品）。由于浏览器曾经认证过，所以被访问的网站会认为是真正的用户操作而去执行。这利用了web中用户身份验证的一个漏洞：简单的身份验证只能保证请求是发自某个用户的浏览器，却不能保证请求本身是用户自愿发出的。

## 防止
### 同源政策
只有同源的网站可以访问操作
- Cookie的`SameSite`设置为`strict`或`lax`，防止第三方网站读取或修改cookie
- 检查 `Referer` 头，确保是从合法来源发起的（ `Referer` 头可以被篡改）
- 检查 `Origin` 头，检测来源（同样可以被篡改）
### CSRF令牌
每个会话生成一个令牌，敏感操作包含该令牌，攻击者无法获取用户CSRF令牌，没法伪造合法请求
### 双重提交Cookie
在每个用户会话中设置两个相同值的Cookie，一个存储在Cookie中，另一个作为隐藏字段包含在请求中。服务器在处理请求时，比较这两个值，以确认请求的合法性。
