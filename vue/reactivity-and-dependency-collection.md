# 响应式原理和依赖收集

## 介绍

### 响应式原理：

-   Vue2 使用了 Object.defineProperty 来劫持组件中数据对象的属性。当这些属性被访问或修改时，Vue 能够检测到这些变化。
-   Vue3 使用 Proxy 来监听变化

### 依赖收集步骤：

-   观察者 `Observer` 类
    -   构造函数：在构造函数中触发被劫持数据的 `get` ，方便将其添加到 `Subject` 实例中
        -   观察者创建应该在劫持数据之后，否则创建的时候还没有 `get`
    -   更新函数（这边主要用来更新视图）
-   被观察者 `Subject` 类
    -   存储观察者们
    -   通知所有观察者更新（当数据变化的时候通知所有观察者）
-   通过 `Object.defineProperty` 劫持数据
    -   创建一个 `Subject` 实例
    -   `get` : 触发 `Subject` 实例添加观察者
    -   `set` : 触发 `Subject` 实例通知所有观察者

1. 数据劫持：通过 `Object.defineProperty` 对响应式数据进行劫持，在获取（`get`）和设置（`set`）属性值时触发相应的操作。
2. 创建依赖对象： 在组件初始化时，Vue 创建一个**依赖对象**（`Subject`），用于存储所有依赖于响应式属性的观察者（通常是组件的渲染函数）。
3. 依赖收集（ `get` 触发）：当读取响应式数据时，会将当前的 `Observer` （观察者）添加到依赖列表中。
4. 派发更新（ `set` 触发）：当响应式数据发生变化时，会遍历依赖列表，通知相关的 `Observer` 进行更新操作。

### 依赖收集与异步更新队列的关系

-   当响应式数据发生变化时，Vue 会触发 `setter`，通知所有依赖于该数据的组件。
-   这些组件的更新请求会被放入异步更新队列中，而不是立即执行。
-   在当前事件循环的下一个“tick”中，Vue 会从队列中取出更新请求，并执行组件的渲染函数，更新 DOM。
