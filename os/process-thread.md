# 进程与线程

-   **程序（Program）：**
    -   是为完成特定任务、用某种语言编写的一组指令的集合。
    -   它是**静态**的**代码和相关数据**的集合。
-   **进程（Process）：**
    -   进程是程序执行的实例（可以有多承实例），是程序在执行时的动态载体。
    -   每个进程都有自己独立的内存空间，包括代码段、数据段和堆栈。不同进程的空间互不干扰，单操作系统会提供相应的机制来共享资源。
    -   进程是资源分配的基本单位，操作系统为每个进程分配资源并管理执行。
-   **线程（Thread）：**
    -   线程是进程中的一个执行单元，是 CPU 调度和执行的单位
    -   一个进程可以包含多个线程，这些线程共享进程的资源，如内存空间和文件句柄
    -   线程比进程更轻量级，创建和切换的开销很小
    -   线程可以并发执行，提高程序的执行效率

> 简单说：程序是可以被执行的代码和数据，进程是程序执行的一个实例，操作系统分配给每个进程单独的资源（资源隔离，但是可以通过操作系统提供的机制共享），每个进程的资源，被进程包含的多个线程共享。进程是资源分配的最小单位，线程是执行的最小单位。

## 浏览器是多进程

浏览器是多进程的，每一个 tab 标签都是一个进程。进程中包含 UI 渲染线程、js 引擎线程、http 请求线程等。

## JS 是单线程

### JS 为什么设计成单线程

-   单线程使得语言模型相对简单，便于理解和开发
-   浏览器中需要与 DOM 等进行交互，单线称可以避免复杂的问题（如多个线程同时操作 DOM）
-   早期的 Web 开发需求相对简单，单线程能够满足需求

## 堆（Heap）和栈（Stack）

### 堆

**动态分配** ：用于动态地分配内存，程序可以在运行时根据需要申请或释放内存空间。
**较大空间** ：相对栈来说，堆可以提供更大的内存空间。
**分配和释放操作** ：需要程序员手动管理内存的分配和释放，容易出现内存泄漏等问题。

### 栈

**自动管理** ：由系统自动管理，遵循先进后出的原则。
**存储局部变量** ：用于存储函数调用时的局部变量、函数参数等。
**空间有限** ：栈的空间相对较小，且大小是固定的。

## 进程线程与堆栈的分配

-   一个进程只有一个堆，至少有一个栈
-   每个线程都有自己独立的栈，但是他们共享堆（线程共享进程的堆）

### 进程：

-   **堆** ：
    -   一个进程通常只有一个堆，用于动态内存分配。
    -   堆是一块可以在运行时请求和释放内存的区域。
    -   进程中的所有线程共享这个堆。
-   **栈** ：
    -   每个进程至少有一个栈，用于存储局部变量、函数参数、返回地址等。
    -   每个线程都有自己的栈，以支持独立的函数调用序列。

### 线程：

-   **堆** ：线程不单独拥有堆，它们共享所属进程的堆内存。
-   **栈** ：每个线程都有自己的栈，用于存储线程特定的局部变量和调用栈。

### 为什么每个线程都有自己的栈

-   **线程执行独立性**：每个线程在执行时都需要有自己独立的空间来存储局部变量、函数调用信息等，以保证线程之间的执行互不干扰。
-   **上下文切换**：当线程进行上下文切换时，栈上的信息可以完整地保存和恢复，确保线程切换前后的状态一致性。
-   **函数调用和返回**：线程需要独立的栈来管理各自的函数调用和返回操作，避免相互影响。
-   **异常处理**：当线程中的代码抛出异常时，异常处理逻辑可以仅针对该线程的栈进行，而不会影响到其他线程的执行。
